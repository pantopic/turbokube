# see terraform.tfvars
variable "region" {}
variable "ip_address" {}
variable "ssh_key" {}
variable "etcd_replicas" {}

terraform {
  required_providers {
    digitalocean = {
      source  = "digitalocean/digitalocean"
      version = "~> 2.68.0"
    }
  }
}

provider "digitalocean" {
  # set env var DIGITALOCEAN_ACCESS_TOKEN
}

resource "digitalocean_project" "turbokube" {
  name        = "turbokube"
  description = "Tha whistles go WOOO"
  purpose     = "Education"
  environment = "Staging"
  is_default  = true
}

resource "digitalocean_tag" "turbokube" {
  name = "turbokube"
}

resource "digitalocean_tag" "apiserver" {
  name = "apiserver"
}

variable "node_count" {
  default = {
    apiserver : 3
    etcd : 3
    scheduler : 4
    worker : 12
  }
}

variable "node_max" {
  default = {
    worker : 24
  }
}

# https://slugs.do-api.dev/
variable "node_class" {
  default = {
    admin : "s-2vcpu-4gb"
    apiserver : "m-8vcpu-64gb-intel"
    etcd : "g-4vcpu-16gb-intel"
    metrics : "g-4vcpu-16gb-intel"
    scheduler : "g-4vcpu-16gb-intel"
    turbo : "g-4vcpu-16gb-intel"
    worker : "m-2vcpu-16gb-intel"
  }
  # default = {
  #   admin : "s-2vcpu-4gb"
  #   apiserver : "m3-8vcpu-64gb-intel"
  #   controller-manager : "s-4vcpu-16gb-amd"
  #   etcd : "so-8vcpu-64gb-intel"
  #   metrics : "s-4vcpu-16gb-amd"
  #   scheduler : "g-4vcpu-16gb-intel"
  #   turbo : "s-4vcpu-16gb-amd"
  #   worker : "s-4vcpu-16gb-amd"
  # }
}

//                                                                      . .---:.::::                                    
//                                                                      :  .::=-:::...                                  
//                                                                     .:..::-=:..:...                                  
//                                                                    ..:..::--:-:::..:.       .   ..                   
//                                                            ..      ..-:.:==-::-:-----...  .. ..:..                   
//                                                             ..    ..:-:::==-::::--::-::. ......:..                   
//                                                          ....-.    .::::===:.-::=--::.......::-:.:....               
//                                                        :-:...--:.  .:-:-===:.:-:==::::-=------+=--::::::.            
//                                                    ..:==-......-::.::--=+=-::---==--===++=--======-:-:.:             
//                                   .                 :-*=:=+===-=---=:===+=-::------===++===-=--==----:..             
//                                   .                 .*#*=+-+=-+---===+++==-::=----===+===++==--==--:-:...            
//                                   .                .:+#+*+*#%###+=++==++==--------==++====++=====-----::::.          
//                           .                    :=  ..+#+*%#%##%%#***+=++=-==-:----==+=+===+++=+====-====--:          
//                          .-:.         .         -=: :*%###%**#%%###*+====----------==++===+++=*==+====----:.         
//                           .:::.:-.  ..   .     .:=+:+#%##*++**##***+=-=-==-=----:---=+++==+*==+==+==+=++=-:.         
//                          ..:::+=+-.   ...  ....::-*-*#%%*=-+**+*+*=------=-===--::---==+=+++-++===++++++*=-:         
//                     .   ...::::+*=...: .  .-=-=#=-**#%#*+++====+++-::::-=-=-==::::---=++++++=+++++++++===+=:         
//                     .-  . .:-==-**::=+=..::--=*#=#%%%%#*+++==-+++=-..:::--=--+:...::--==+++==+=++****+====-.         
//              .    .  :....:-:+=:=%--==#=-*+++##@##@@@#**+++=--*+=-:.:::::--::=:...:----=++=-+++**#***++=--:.         
//               ...    .-::..=+=-::*#-=++***%*****%#%%#+=+*+-=----:..:::::::::.::  .:--:--=++-++********+=--:          
//             .. .::  ..:- .-:=*-=-=##+**%*##%%#*+*+**+++=+=-=:::-:...::-:-... .. ..:==----==-=++++****++=--.          
//            .-#=. =-:-.:=:.-=-=-=++*#*+*###%#%#**++======*==-:.::-....::::.   . ....----:::--=+==++***++=--..         
//           .=*%%+=---::+-+::--*=**==***#%#*%##**+======+=+=--..:--:..::....  .    ..--=--::---===++***++==--.         
//        .:.:*%@%#++-==-*#*-=**#**#++****#***#*++=-==-=+==+=-:..:-::..::.... ..     .:-===-:--===-++++++===---:        
//      . .-.:+%%#*+#*##**%*#=+#%%%%%#+==+#+==+====-=--==-==::  ...  ..::..:. .      .:--==----++==++====+=====-        
//       .. :=#%#+*####**+#*%*+%%%%@#+===-*=-=-::=======---::.      ...::........     ..:-----==++++===========:        
//        :.-#*#%#**#**+%#*####%%%%#*+=---==-:..===-==-::-:...     ......::::---::::.. ..::::--=+++==========-::.       
//.      :=+%*-+@@##%%+++%*#*#%%%@%#*+=-:---::.:==----:::-. .      .....:::---=------:.....:::--===-========--:::       
//..     .-*%=**%@@%%%#**####%%%%@%#*=--::::::::-::::. ..    ........::::-----=========-::::::---==-====+===-::.        
// ::. .. :+#+-*=###@%###**##%%%@%#*+==--:::::-:....   .   ...:::.:::::::----======+++++==--:::::-=---=======-:.        
//  :.::::+:-*+##+*+%@%*%#%%%@@@@%#*====-:::......        ..:::::::::::------====++++++++++=-...::-:--=+++====-.        
//  .. ..-*+*+###*#*%%@@@@@@@@@@@%#*+*+==-:......       ...::::::::::::---====+++++++++++++++-..::::--==+++==-:         
//   . ::-##+=%@%*#%#%@@@@@@@@@@%%%**#+=--:....        .::::--::::::::::--====+++******+++++++:..::::--=====-:.         
//    :=*+*#*+*%@@%@#@@@@@@@@@@@%%#*##*+=-:.......    .:::-----:::-:----===+++++********++++++=..::::-===+===:..        
//  ..:-###*####%%@%#%@@@@@@@@@@%%**##**=::............:::-----::------===++++*********+++*+++=....::-==++===::.        
//  . ...=###%@**%%%%%@@@@@@@@@%%#*****+=::::..........:::----------------====++**#*#*******+++..:::-==++++++=-.        
//  :-.::-+*%*####%%%@%@@@@@@@@@@#*+**+=---::::.......::::---------------------==+*#####*****++-.:::=====+++++=.        
// .*--+*#**@#*##%%%%%%%@@@@@@%@%#*+++=---:::-:.......:::-------------------------=*#*#####***++:::--==++++++==:        
// :*#%@@@@###=#@@@@@%%@@@@%%%%##*++==--::::::. .....:::---------------------------=+*######****-:::==+++**+++=:.       
//.-#@%%%@@@%#%@%%@@@%%@@@@@%#%%##*==--:::::..... ...::------------------------------+#######***=::-==+++*****+:.       
//.=@%@@@@@@@@@%%%%%@@%@@@@@%%#***=---:::::.. .   ...::-------------------------------+#######**+--======++++++-.       
//:#@%@@@@@@@@@%@%%#@@@@@@@@%%%#*+=--:--:....    .....:---------:----------------------=+*#####*+:--====-==+++=-:       
//.+@@@@@@@@@@@%%@%#%%%@@@@@@%###+==-:::....     .....:--------::---:---:------------:-:-+**###*+:-====-===-=++-.       
//.+@@%@@@%@@@@%%#%%%%@@@@@@%#**+==-:::.         ....::------:::.......:-------------::::-+**##**--==-==+======-:       
//-*@@@@%%@@@@@%*+#%%#%@@%@%%%##+=-::..            ..:-----:.           .:------------::::-+*****=-=-=++++==-=-:..      
//:-*%##%*%@@@%#*+*#%#%@@@@%%##*+=-:..            ..:--:-:.        .....  .:----------::::::+****====++++****+-:..      
//.::-**%#%@@@#**#%%%%%@@%@%%#**+-:..             .:::-::.       ..:....    .:---------::::::+***====+++*##***+==..:.   
//.=..:*##%@@##*####%%%%%@@%##**-::.              ..-*#-.       ::::::..-+===----------:::...:=+*==+++*###%#+==+*=:-.   
// --::+=*%@%###%#*#%%%%%%%###*=-:..                .-.:.    . -+-----+*=:...:----:--:::.     ..===+***#%%%%#=+***+:    
//  ::.--++*#%%@%%%%%%%%%%%###*=-...                .         -%+*===#*:...    :--:--:.     .:.  :-+**#%%%%%#*+*%%*:    
//    .::=+=##+*%%@@%##%%%####+-:.::..              .   .     -%#*=+%+::..:.    .--::.     ....    .-+#%%%%###*##+=.    
//    ::-+*#%+*#%%@%%#%%%%%###=----:..              -   :.... .=@+#%+.......     .-:.     .. ...:+#%%##*%@%#####+=-.    
//     :*=%%#%#%@@%%%###%%%#%#=:--:...              :   =:::::-*@%%*..    ..      :=     ...:..-#*-...-++*%%%%%#+=-.    
//     :-#@%@@%%@%%%%%%%%%%#%#=:--...               .   .... :=**@@=-:: . ..      .-.   ...:..*+.      .-=#%%%%%*+=:..  
//    .+=@@%%@@%%%%%%%%%%%###*=:::....              :  -.:..  :=+%*.. .  .         ::   .....-+.         :+%@@%%%#*+-.  
//    .=%@@@%@@%%%%%###%%%###*=::.....             .:=+-::::..:=+#=.               ::   . . -*..          :*@@%@%#*+-.  
//  ...-#%#%%@@@%%%##%%%%####+=::.....           ..::==.     .::-+-:::.. .         :-   : .:*: .           =@@@@%#*=:.  
//   . :-+++*%#%%%##%%######*++-:.....  ... ..  ...:----.    .:::=:::::..          :=...:. ==              :#%%@@#*+.   
//   : ::-*=*###%####%%%###***+=:. ... .:.. .. ....:----:     :::=-::::..         :+=-:.::.+:              .*@%%%%*+-   
//  .-..:-=+#***#%%%%######*#*+=-. ..  ::..   ....:---==--    ..:--::::.          .=:.:..::+...             +%%@%%#--.  
//  ....::=+**+*#%%%##%###**+++=-:.....-:.  ......::--==-=-.   ..:-::::.          :#.  . .:=.:.             =%%@%#+-.   
//   ...::-+*+**+#%%######**+==-::::...:.  ........:--=--==-.   .:-:::.          .++: .: .:+::...          .=%####=-:...
//    .:===+++%**#%%######*++==-::::...:.   .......:-----==--.   :-.            .+%+-..:..:+:....          -+#**#*++::. 
//     . :-=+=*###%#####****+==-:::::. ..   .......:-----=----:. .:-.           =%##=.::-.:=::.            :#%**==--.   
//       .-=-+*##%#%%#%#**++===-::::..   ..  .....::--------===-::::-:         =%**##-:-:::=-:            .*%%##=--.    
//        .:--==*###%%%***++===-:.::::..:::.......:---------==+++=====:.    .:=++*#%##---::-=.            -%@@%*+::..   
//       . .::=:=*%%%%%****++=--:.::-. .----:::.::----------==+*######==----++==+#####%=-:::=.            +%@%#*#+:.    
//       ... :.-+@@@%##***++===-:.:=:.  ----:-:------------==+*##%%%##*=:-======+#%##*%#=--::-          .=@@@%%#==:.    
//     .   .::.-*#%%#*+*+*+++==-::*=:.  .-----:-----------==+**#%####**+=---=-=+#%%###*##+==--=:       :*%@@@%#*==.     
//     ..  ....-+*%#****++++=-:-:-%-:.   .---::-----------==+*#%%###**+++==-:-=*#@@%#%#*%%#**++*=:  .:*%@@@@%%#*-:      
//           ..-**#****++=+=:-=++-*::.     .:::--:-------===**#*+++++==+====-:=*%%@%%%%**%%%##***%%%%%=-#@%%@%#*-.      
//           ..-+*##**#***=--==+==*::..     :::---------===+*#+------------=*+-+#%%%%%%%**%%%%##%@@@@@#--#%%@%%#=.      
//  .        .:-***#**#%%@*-=--==**::..     :::--------====+#*:--=-:::::::-=+#%*####%%%%%=#%%%#@@@@@@@@*:-##%@%*:       
//    ...    .:--+*#***#%%*-==+***+:::.     :::-------==+=+*#======---:---==*###*==**##%%**%%##@@@@@@@%%=:**#*=:  .     
//-. .....  ...:-=*#****##*==***+==:.::.  ::::--------=+==+*%*+++*+++======+###*+--===**#**#%##@@@@@@@%%*:-++::...      
//**=:.  .....  .-+##**++**+=**=====:-:. :-:::--------=+==+#%###*+====+++***####+-------++*###%@@@@%%@@@#-.+*::. .      
//****++=:.     ..=+*##****+-======+-:::.--:::--------=+==+#%###*:----+++*****###+==---==+###%%@@@@@@@@@%=.=-..         
//******%%#+-. ..-:-++***#**=-==++++=:::=-:::::-:-----=+==+#%###+=-=-=*+*++**#####**++=--+###%@@@@@@@@@@%= -..          
//****+++#@%#%+:....-=+*###+=-=+##*==-:=*--:::::::----====+#%##*+=-.-=++#**%##%##+.:-**=-=####@@@@@@@%@@%: --.          
//*****+++%#%%%#+:..:-*%%**++=+**#*#*=-:+-::-:::::----====*###**++=:::++**%@#%%%%:.:-+*+*####%@@@@@@%###=.::..          
//****++++*####*#*=...:*%#++++****#%%+=--=::--:::::---====*####*++==-:--**#%%@@%#.:=*#**#%##%%@@@@%%**==..-.            
//****+++*####%#***-..::+=--*==+*#%%%%*=-:-:=-:::::---==-=*###**++====-:-==**##*::=*##**#%##%%@@%#+=+--  .:   .         
//***++*#%%%##%**+++:...:-::---=+***###===-:==-::::---==-=+*##**++=============-=+*###*#####+=%@%*:.::.. . ..           
//**++#%%@%####*++++-.....:.::--+#*=--===-==-=-:::::---=--+*#***++====+++*****++**#*##*####*-::**=:-+:...   .  .        
//*+*%@@@%****#++++++:.......:-+%#*+=::--::-+-::::::---=--+*****+++==++*****###**##########-:.....=-.. ......           
//#%%@@%#******+++++*+===+-:.:-%@#+++=---: .-==::-:::---=-=**+**++++++****################+......:::... ....  .         
//%@@%#********++++++*=+***=::=@@%*+===--:  ---=-::::---=-=++++++++++***##*##############*:.......:.........  .         
//@%%**********++++++*++++++-:=%###*+=--+=. -=:-==::::---=-====++++++******#############*:....:.::.........   .         
//@%*********++++++++**+++++=:-+++***+--+=-.:*=-:--::::-:-==========++****##############-....::.............  .         
//#*********++++++++**#*+++==--==+++++=:++=::#+=::--:::-:-----=====++++****######*#####-.:.:::.............. .          
//**********+++=++++***##*=-++=--=+++++==++=.=*==-:--:.:-------=====++++**********####=:...::...............            
//***********+++++***#####-:=++=:-=++++++++=::-===::--::-:------=+=++++***********###=:::::::...............         . .
//********++***+**##**####-:==++-:-=++***++==:::-=-::-=::-:-----=+=++************#*#+:::.::::...............        ....
//******+++**+**###*****##+-====+---=***+*+===-::---::--::-:-=--==+++***********###+::::::-:::................     .....
//****+++++++**###******##*=====++==-=++**#*+==-:::--::------==--=++****#####**###*-:::::--..::...............    ......
//****+++++****##**+*****#*======+=====+****+++++-:---::=-:---==-=++****##%######**=:.:::-..:::::.............  . ......
//****+++++++**##********##++====++===+=+***#***++=-:--:--::---=+==++****#######*+#@%#+--:....:................   ......
//***+++++++*###**+******##++====+++==++++*#%##**+*+=---:=-:---==+++++*****###*++**#@@%#-:..::::::.............  .......
//+**++++++*###*+*********#++====++++=++++***###%*+***=:-:+---==-=++++++***#**=+*#@*#%%+-::.:...::......................
//+++++++++*##*******+****#+==+=++++++++++**##%%%#+**##*-:-=-+======++******=-+**#@%%#%=-=-..:..........................
//++++++++**##**+****++***#*=+++++++++*++***##%%%%#+**##%+-*-=+++++++++++*+=-+***#*%@@%=::::::....::....................
//++++++++****++++*+**++**#*=+++++++++**+**+*#%%%%%*+++#%#**=-++********+-::+******+@@#+-:..::....:::...................
//=+++++++****+++*++++++**##++++++++++********##%###****#%*+=-*#**+=++=-:::-****%@#++*=:=#*+:.:.........................
//-=++++++****+++++++++++*##+++++++++++**+*##**#%%%#*****##*=-=@@@%#**+----=*##@@#==++--+@@@#-.::::::...................
//=====++++***+++=====+==+*#+========+++**+######%%**+++**++=-:+%%%@@@@*+++*%@@@%---=++:=@@@@%=:::::::..................
//=====+++++*+++++========+**============++++#%#*####***+++=--::-#@@@@#++++#%%%*#----+*:*@@@@@@=::::::::::::::..........
//====++++++++****++=======**=====--======*=+**+#**###%%*+++=----=%@%%*+++*##*+=#==-=*:-*@@@@@@%:::::::::::::.:.........
//+++++++++++**++++========+*============++*=++*****+*%%#**++-::+:+*#*+++++*%@%%****##::=@@@@@@@+::::::::::::::.........
//++++=++=======---::---===+*+++++*********#########****##**=::-+==**+++++++%%%*++++%#::=%#%@@@@#:::::::::::::::........
//===----::------:::----===+++++==+**********##%####***+****+----==******=-----=***+#*::=@@%%@@@#-::::::::::::::::......
//----:::::-------------===++=++=====++==+++****+++======++==---:-:---=+*:....:-+*=+@*::=@@@@@@@@=::::::::::::::::......
